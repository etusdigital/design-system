import{d as W,m as c,c as X,C as Y,E as O,D as P,f as A,q as s,z as L,l as E,r as R,o as S}from"./vue.esm-bundler-B3dae8Cn.js";import{g as Z}from"./index-BQ4pCYp0.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F=["width","height","viewBox"],G={id:"highlight-mask"},J=["width","height","rx","ry"],K=["src"],Q=["src"],D=W({__name:"BCrop",props:{modelValue:{default:void 0},src:{default:void 0},width:{default:"360px"},height:{default:"200px"}},emits:["update:modelValue"],setup(U,{emit:q}){const N=U,i=c(!1),r=c(),n=c(),p=c(),x=c(0),m=c(new Image),d=new Image;d.src=N.src;const h=c({width:0,height:0}),b=new ResizeObserver(V),_=X(()=>{var t,e;return(document.readyState==="complete"||document.readyState==="interactive")&&((e=(t=r.value)==null?void 0:t.computedStyleMap().get("--border-radius-xl"))==null?void 0:e.toString())||"16px"}),T=q;Y(async()=>{window.addEventListener("mousemove",v),window.addEventListener("mouseup",()=>{i.value=!1}),window.addEventListener("touchmove",B),window.addEventListener("touchend",()=>{i.value=!1}),r.value&&b.observe(r.value,{box:"border-box"}),d.onload=()=>{k(x.value)}}),O(V),P(()=>{b&&b.disconnect(),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",()=>{i.value=!1}),window.removeEventListener("touchmove",B),window.removeEventListener("touchend",()=>{i.value=!1})});function V(){var t,e,o,a;h.value.width=(t=r.value)!=null&&t.clientWidth?((e=r.value)==null?void 0:e.clientWidth)+10:0,h.value.height=(o=r.value)!=null&&o.clientHeight?((a=r.value)==null?void 0:a.clientHeight)+10:0}function $(t){i.value=!0,B(t)}function I(t){i.value=!0,v(t)}function B(t){v(t.touches[0])}function v(t){if(!n.value||!n.value.parentElement||!p.value||!i.value)return;const e=Z(t,n.value,n.value.parentElement,{left:!0,top:!0},{x:-1,y:-3});n.value.style.top=`${e.y}px`,n.value.style.left=`${e.x}px`,p.value.setAttribute("x",e.x.toString()),p.value.setAttribute("y",e.y.toString()),z(n.value,n.value.parentElement)}function k(t){const e=document.createElement("canvas"),o=e.getContext("2d");if(!n.value||!n.value.parentElement||!o)return;const a=t+1,l=n.value.parentElement.getBoundingClientRect(),u=n.value.getBoundingClientRect();e.width=l.width,e.height=l.height;const g=(l.width-d.width)/2,f=(l.height-d.height)/2;o.drawImage(d,g,f);const w=u.left+u.width/2-l.left,y=u.top+u.height/2-l.top;o.clearRect(0,0,e.width,e.height),o.save(),o.translate(w,y),o.scale(a,a),o.translate(-w,-y),o.drawImage(d,g,f),o.restore();const C=e.toDataURL("image/png");m.value=new Image,m.value.src=C,m.value.onload=()=>{!n.value||!n.value.parentElement||z(n.value,n.value.parentElement)}}function z(t,e){const o=t.getBoundingClientRect(),a=document.createElement("canvas"),l=a.getContext("2d");if(!l)return;a.width=o.width,a.height=o.height;const u=e.getBoundingClientRect(),g=o.left-u.left,f=o.top-u.top,w=g,y=f,C=o.width,H=o.height;l.drawImage(m.value,w,y,C,H,0,0,o.width,o.height);const M=a.toDataURL("image/png");T("update:modelValue",M)}return(t,e)=>{const o=R("BIcon"),a=R("BSlider");return S(),A("div",{ref_key:"bCrop",ref:r,class:"b-crop w-full h-full"},[s("div",{class:"relative w-full h-full bg-black rounded-xl",style:L({"min-width":t.width,"min-height":t.height})},[s("div",{class:"crop-img",onClick:I},[(S(),A("svg",{class:"absolute z-1",width:h.value.width||"0px",height:h.value.height||"0px",viewBox:`0 0 ${h.value.width||0} ${h.value.height||0}`,xmlns:"http://www.w3.org/2000/svg"},[s("defs",null,[s("mask",G,[e[1]||(e[1]=s("rect",{width:"100%",height:"100%",fill:"white"},null,-1)),s("rect",{ref_key:"selectedArea",ref:p,x:"0",y:"0",width:t.width,height:t.height,rx:_.value,ry:_.value,fill:"black"},null,8,J)])]),e[2]||(e[2]=s("rect",{width:"100%",height:"100%",fill:"rgba(255, 255, 255, 0.7)",mask:"url(#highlight-mask)"},null,-1))],8,F)),s("img",{src:m.value.src,alt:"model value"},null,8,K),s("img",{src:t.src,style:{position:"relative",visibility:"hidden"}},null,8,Q)]),s("div",{ref_key:"cropArea",ref:n,class:"crop-area",style:L({width:t.width,height:t.height}),onMousedown:I,onTouchstart:$},null,36)],4),s("footer",null,[E(o,{name:"zoom_out",class:"select-none"}),E(a,{modelValue:x.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>x.value=l),k],size:"small",max:2},null,8,["modelValue"]),E(o,{name:"zoom_in",class:"select-none"})])],512)}}}),ne=j(D,[["__scopeId","data-v-57c9e396"]]);D.__docgenInfo={exportName:"default",displayName:"BCrop",description:"",tags:{},props:[{name:"modelValue",required:!1,type:{name:"string"},defaultValue:{func:!1,value:"undefined"}},{name:"src",required:!0,type:{name:"string"},defaultValue:{func:!1,value:"undefined"}},{name:"width",required:!1,type:{name:"string"},defaultValue:{func:!1,value:'"360px"'}},{name:"height",required:!1,type:{name:"string"},defaultValue:{func:!1,value:'"200px"'}}],events:[{name:"update:modelValue",type:{names:["string"]}}],sourceFiles:["/Users/albertoandre/Dropbox/aa-projects/Github/design-system/src/components/BCrop/BCrop.vue"]};export{ne as B};
